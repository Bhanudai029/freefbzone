<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FB Video Downloader</title>
    <!-- Add Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0b;
            color: #e8e6e3;
            min-height: 100vh;
            line-height: 1.6;
        }

        .grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.03;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><defs><filter id="noiseFilter"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter></defs><rect width="100%" height="100%" filter="url(%23noiseFilter)" opacity="0.4"/></svg>');
            z-index: 1;
        }

        .container {
            max-width: 680px;
            margin: 0 auto;
            padding: 60px 20px 40px;
            position: relative;
            z-index: 2;
        }

        .header {
            margin-bottom: 50px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .fb-icon {
            width: 48px;
            height: 48px;
            background: #1877f2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }

        .fb-icon:hover {
            transform: scale(1.05);
        }

        .fb-icon svg {
            width: 26px;
            height: 26px;
            fill: white;
        }

        .brand-text h1 {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .brand-text p {
            color: #9ca3af;
            font-size: 15px;
            font-weight: 400;
        }

        .main-section {
            background: #111827;
            border: 1px solid #1f2937;
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 32px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }

        .form-group {
            margin-bottom: 32px;
        }

        .label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #d1d5db;
            margin-bottom: 8px;
        }

        .input-wrapper {
            position: relative;
        }

        .url-input {
            width: 100%;
            padding: 16px 20px;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 12px;
            color: #e5e7eb;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.2s ease;
            outline: none;
        }

        .url-input::placeholder {
            color: #6b7280;
        }

        .url-input:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
        }

        .url-input.error {
            border-color: #ef4444;
            animation: shake 0.4s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        .download-btn {
            width: 100%;
            padding: 18px 24px;
            background: #1877f2;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .download-btn:hover {
            background: #1664d9;
            transform: translateY(-1px);
        }

        .download-btn:active {
            transform: translateY(0);
        }

        .download-btn:disabled {
            background: #374151;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            min-height: 24px;
        }

        /* New loader from UIverse.io */
        .loader {
            position: relative;
            width: auto;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            margin-right: 0px;
        }

        .bar {
            width: 3px;
            height: 20px;
            background: #8AFF8A; /* Matching the green from the image */
            display: inline-block;
            transform-origin: bottom center;
            border-top-right-radius: 10px;
            border-top-left-radius: 10px;
            animation: loader8913 0.8s linear infinite;
        }

        .bar1 {
            animation-delay: 0.1s;
        }

        .bar2 {
            animation-delay: 0.2s;
        }

        .bar3 {
            animation-delay: 0.3s;
        }

        .bar4 {
            animation-delay: 0.4s;
        }

        .bar5 {
            animation-delay: 0.5s;
        }

        .bar6 {
            animation-delay: 0.6s;
        }

        .bar7 {
            animation-delay: 0.7s;
        }

        .bar8 {
            animation-delay: 0.8s;
        }

        @keyframes loader8913 {
            0% {
                transform: scaleY(0.2);
            }

            50% {
                transform: scaleY(1);
                background: #ADFF2F; /* Slightly different shade for peak */
            }

            100% {
                transform: scaleY(0.2);
                background: #8AFF8A;
            }
        }
        
        /* Animation keyframes for wifi-loader-download */
        @keyframes circle-outer135 {
          0% {
            stroke-dashoffset: 25;
          }

          25% {
            stroke-dashoffset: 0;
          }

          65% {
            stroke-dashoffset: 301;
          }

          80% {
            stroke-dashoffset: 276;
          }

          100% {
            stroke-dashoffset: 276;
          }
        }

        @keyframes circle-middle6123 {
          0% {
            stroke-dashoffset: 17;
          }

          25% {
            stroke-dashoffset: 0;
          }

          65% {
            stroke-dashoffset: 204;
          }

          80% {
            stroke-dashoffset: 187;
          }

          100% {
            stroke-dashoffset: 187;
          }
        }

        @keyframes circle-inner162 {
          0% {
            stroke-dashoffset: 9;
          }

          25% {
            stroke-dashoffset: 0;
          }

          65% {
            stroke-dashoffset: 106;
          }

          80% {
            stroke-dashoffset: 97;
          }

          100% {
            stroke-dashoffset: 97;
          }
        }

        @keyframes text-animation76 {
          0% {
            clip-path: inset(0 100% 0 0);
          }

          50% {
            clip-path: inset(0);
          }

          100% {
            clip-path: inset(0 0 0 100%);
          }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-message {
            margin-top: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            display: none;
        }

        .status-message.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .status-message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .status-message.info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        
        .mock-download-link {
            display: block;
            margin-top: 12px;
            padding: 10px 16px;
            background: rgba(24, 119, 242, 0.1);
            border: 1px solid rgba(24, 119, 242, 0.2);
            border-radius: 8px;
            color: #1877f2;
            text-decoration: none;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .mock-download-link:hover {
            background: rgba(24, 119, 242, 0.2);
            transform: translateY(-1px);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 32px;
        }

        .feature-card {
            background: #111827;
            border: 1px solid #1f2937;
            border-radius: 12px;
            padding: 24px;
            transition: all 0.2s ease;
        }

        .feature-card:hover {
            border-color: #374151;
            transform: translateY(-2px);
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background: rgba(24, 119, 242, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            font-size: 20px;
        }

        .feature-title {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .feature-desc {
            font-size: 14px;
            color: #9ca3af;
            line-height: 1.5;
        }

        .footer-note {
            text-align: center;
            color: #6b7280;
            font-size: 13px;
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid #1f2937;
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            .container {
                padding: 40px 16px 32px;
            }

            .main-section {
                padding: 32px 24px;
            }

            .brand h1 {
                font-size: 24px;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 32px 16px 24px;
            }

            .main-section {
                padding: 24px 20px;
            }

            .brand {
                gap: 12px;
            }

            .fb-icon {
                width: 44px;
                height: 44px;
            }

            .brand h1 {
                font-size: 22px;
            }

            .url-input {
                padding: 14px 16px;
                font-size: 16px;
            }

            .download-btn {
                padding: 16px 20px;
            }
        }

        /* Subtle animations */
        .main-section {
            animation: fadeInUp 0.6s ease-out;
        }

        .feature-card {
            animation: fadeInUp 0.6s ease-out;
        }

        .feature-card:nth-child(1) { animation-delay: 0.1s; }
        .feature-card:nth-child(2) { animation-delay: 0.2s; }
        .feature-card:nth-child(3) { animation-delay: 0.3s; }
        .feature-card:nth-child(4) { animation-delay: 0.4s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Logo animation */
        .fb-icon {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.10); } /* Increased scale for more noticeable pop-up */
            100% { transform: scale(1); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Download button animation */
        .download-btn:active:not(:disabled) {
            animation: btnClick 0.3s ease;
        }

        @keyframes btnClick {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* Success animation */
        @keyframes successPulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        /* Video info results styles */
        #videoInfoResults {
            background: rgba(31, 41, 55, 0.7);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 24px;
            margin-top: 30px;
            animation: fadeIn 0.5s ease-out;
        }

        /* Download section styles */
        .download-section {
            margin-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }

        .downloads-title {
            color: #d1d5db;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .download-options-row {
            display: flex;
            gap: 8px;
            align-items: center;
            position: relative; /* For absolute positioning of the menu */
        }

        .quality-dropdown {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 12px;
            color: #e5e7eb;
            padding: 12px 15px;
            font-size: 15px;
            cursor: pointer;
            flex: 1;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23d1d5db' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: calc(100% - 12px) center;
        }

        .quality-dropdown:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 2px rgba(24, 119, 242, 0.2);
            outline: none;
        }

        .download-video-btn {
            background: #22c55e;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background 0.2s ease;
            flex-shrink: 0;
        }

        .download-video-btn:hover {
            background: #16a34a;
        }

        #downloadBtnDownload {
            margin-left: 150px; /* Adjust this value to move the button more or less */
        }

        /* Add a new class for the bottom overlay */
        .thumbnail-bottom-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.3) 50%, rgba(0,0,0,0));
            z-index: 3;
            pointer-events: none;
        }

        .video-info-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .creator-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .creator-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #1877f2;
            cursor: pointer;
        }

        .creator-name {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin: 0 0 4px;
        }

        .followers {
            font-size: 14px;
            color: #9ca3af;
            margin: 0;
        }

        .video-stats {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-icon {
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-icon svg {
            fill: #9ca3af;
            width: 18px;
            height: 18px;
        }

        .stat-value {
            font-size: 14px;
            color: #d1d5db;
            font-weight: 500;
        }

        .video-content {
            margin-top: 20px;
        }

        .video-thumbnail-container {
            width: 100%;
            max-height: none; /* Remove max-height restriction */
            min-height: 200px; /* Prevent container collapse while loading */
            overflow: hidden;
            border-radius: 8px;
            position: relative; /* Added for timestamp positioning */
            margin-bottom: 8px; /* Reduced from 16px to accommodate the timestamp below */
        }

        .video-thumbnail {
            width: 100%;
            height: auto; /* Allow height to adjust based on aspect ratio */
            object-fit: contain; /* Changed from cover to contain to preserve aspect ratio */
        }

        /* Add new styles to hide page name overlay on thumbnail */
        .video-thumbnail::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0));
            z-index: 2;
        }

        /* This will hide any text elements that might be automatically added by Facebook's embed */
        .video-thumbnail-container .fb-page-name {
            display: none !important;
        }

        .video-description {
            font-size: 15px;
            line-height: 1.5;
            color: #e5e7eb;
            margin-bottom: 12px;
        }

        .uploaded-date {
            font-size: 13px;
            color: #9ca3af;
        }

        .video-timestamp {
            position: relative; /* Changed from absolute */
            margin-top: 8px; /* Add margin to position below the thumbnail */
            margin-left: auto; /* Push to the right side */
            width: fit-content; /* Make it only as wide as its content */
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .video-timestamp svg {
            width: 16px;
            height: 16px;
        }

        @media (max-width: 640px) {
            .video-info-header {
                flex-direction: column;
                gap: 20px;
            }

            .video-stats {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #111827;
        }

        ::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }

        /* Styles from test.html */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
            background-color: #121212; /* Even darker background */
            color: #e0e0e0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .container {
            max-width: 900px; /* Wider container */
            margin: 2rem auto;
            padding: 2.5rem;
            background-color: #1e1e1e; /* Slightly lighter card background */
            border-radius: 12px; /* More rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3), 0 6px 10px rgba(0,0,0,0.22);
        }
        input, select, textarea {
            background-color: #2a2a2a; /* Darker input fields */
            color: #e0e0e0;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 0.75rem 1rem;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #6366f1; /* Indigo focus */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
            outline: none;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary {
            background-color: #6366f1; /* Indigo button */
            color: white;
        }
        .btn-primary:hover {
            background-color: #4f46e5;
        }
        .btn-secondary {
            background-color: #38a169; /* Green button */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #2f855a;
        }
        .icon {
            width: 1.25em;
            height: 1.25em;
            margin-right: 0.5em;
            vertical-align: middle;
        }
        /* WiFi Loading Animation from UIverse */
        #wifi-loader {
          --background: #62abff;
          --front-color: #4f29f0;
          --back-color: #c3c8de;
          --text-color: #414856;
          width: 64px;
          height: 64px;
          border-radius: 50px;
          position: relative;
          display: flex;
          justify-content: center;
          align-items: center;
          margin: 20px auto;
        }

        #wifi-loader svg {
          position: absolute;
          display: flex;
          justify-content: center;
          align-items: center;
        }

        #wifi-loader svg circle {
          position: absolute;
          fill: none;
          stroke-width: 6px;
          stroke-linecap: round;
          stroke-linejoin: round;
          transform: rotate(-100deg);
          transform-origin: center;
        }

        #wifi-loader svg circle.back {
          stroke: var(--back-color);
        }

        #wifi-loader svg circle.front {
          stroke: var(--front-color);
        }

        #wifi-loader svg.circle-outer {
          height: 86px;
          width: 86px;
        }

        #wifi-loader svg.circle-outer circle {
          stroke-dasharray: 62.75 188.25;
        }

        #wifi-loader svg.circle-outer circle.back {
          animation: circle-outer135 1.8s ease infinite 0.3s;
        }

        #wifi-loader svg.circle-outer circle.front {
          animation: circle-outer135 1.8s ease infinite 0.15s;
        }

        #wifi-loader svg.circle-middle {
          height: 60px;
          width: 60px;
        }

        #wifi-loader svg.circle-middle circle {
          stroke-dasharray: 42.5 127.5;
        }

        #wifi-loader svg.circle-middle circle.back {
          animation: circle-middle6123 1.8s ease infinite 0.25s;
        }

        #wifi-loader svg.circle-middle circle.front {
          animation: circle-middle6123 1.8s ease infinite 0.1s;
        }

        #wifi-loader svg.circle-inner {
          height: 34px;
          width: 34px;
        }

        #wifi-loader svg.circle-inner circle {
          stroke-dasharray: 22 66;
        }

        #wifi-loader svg.circle-inner circle.back {
          animation: circle-inner162 1.8s ease infinite 0.2s;
        }

        #wifi-loader svg.circle-inner circle.front {
          animation: circle-inner162 1.8s ease infinite 0.05s;
        }

        #wifi-loader .text {
          position: absolute;
          bottom: -40px;
          display: flex;
          justify-content: center;
          align-items: center;
          text-transform: lowercase;
          font-weight: 500;
          font-size: 14px;
          letter-spacing: 0.2px;
        }

        #wifi-loader .text::before, #wifi-loader .text::after {
          content: attr(data-text);
        }

        #wifi-loader .text::before {
          color: var(--text-color);
        }

        #wifi-loader .text::after {
          color: var(--front-color);
          animation: text-animation76 3.6s ease infinite;
          position: absolute;
          left: 0;
        }
        
        /* Download WiFi Loading Animation - Green variant */
        #wifi-loader-download {
          --background: #4ade80;
          --front-color: #16a34a;
          --back-color: #c3c8de;
          --text-color: #414856;
          width: 64px;
          height: 64px;
          border-radius: 50px;
          position: relative;
          display: flex;
          justify-content: center;
          align-items: center;
          margin: 20px auto;
        }

        #wifi-loader-download svg {
          position: absolute;
          display: flex;
          justify-content: center;
          align-items: center;
        }

        #wifi-loader-download svg circle {
          position: absolute;
          fill: none;
          stroke-width: 6px;
          stroke-linecap: round;
          stroke-linejoin: round;
          transform: rotate(-100deg);
          transform-origin: center;
        }

        #wifi-loader-download svg circle.back {
          stroke: var(--back-color);
        }

        #wifi-loader-download svg circle.front {
          stroke: var(--front-color);
        }

        #wifi-loader-download svg.circle-outer {
          height: 86px;
          width: 86px;
        }

        #wifi-loader-download svg.circle-outer circle {
          stroke-dasharray: 62.75 188.25;
        }

        #wifi-loader-download svg.circle-outer circle.back {
          animation: circle-outer135 1.8s ease infinite 0.3s;
        }

        #wifi-loader-download svg.circle-outer circle.front {
          animation: circle-outer135 1.8s ease infinite 0.15s;
        }

        #wifi-loader-download svg.circle-middle {
          height: 60px;
          width: 60px;
        }

        #wifi-loader-download svg.circle-middle circle {
          stroke-dasharray: 42.5 127.5;
        }

        #wifi-loader-download svg.circle-middle circle.back {
          animation: circle-middle6123 1.8s ease infinite 0.25s;
        }

        #wifi-loader-download svg.circle-middle circle.front {
          animation: circle-middle6123 1.8s ease infinite 0.1s;
        }

        #wifi-loader-download svg.circle-inner {
          height: 34px;
          width: 34px;
        }

        #wifi-loader-download svg.circle-inner circle {
          stroke-dasharray: 22 66;
        }

        #wifi-loader-download svg.circle-inner circle.back {
          animation: circle-inner162 1.8s ease infinite 0.2s;
        }

        #wifi-loader-download svg.circle-inner circle.front {
          animation: circle-inner162 1.8s ease infinite 0.05s;
        }

        #wifi-loader-download .text {
          position: absolute;
          bottom: -40px;
          display: flex;
          justify-content: center;
          align-items: center;
          text-transform: lowercase;
          font-weight: 500;
          font-size: 14px;
          letter-spacing: 0.2px;
        }

        #wifi-loader-download .text::before, #wifi-loader-download .text::after {
          content: attr(data-text);
        }

        #wifi-loader-download .text::before {
          color: var(--text-color);
        }

        #wifi-loader-download .text::after {
          color: var(--front-color);
          animation: text-animation76 3.6s ease infinite;
          position: absolute;
          left: 0;
        }
        /* Success Checkmark Animation */
        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #4ade80; /* Green-400 */
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        .checkmark {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: none; /* Hidden by default */
            stroke-width: 2;
            stroke: #fff;
            stroke-miterlimit: 10;
            margin: 0 auto 10px auto; /* Centered with margin */
            box-shadow: inset 0px 0px 0px #4ade80;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }
        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }
        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px #4ade80;
            }
        }
        /* Utility class to hide elements */
        .hidden {
            display: none !important;
        }

        /* Center and permanently display download status */
        #downloadStatus {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            width: 100%;
            margin-top: 16px; /* Adjust as needed for spacing */
        }

        /* New loader CSS from Uiverse.io */
        .loader {
            position: relative;
            width: auto;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            margin-right: 5px;
        }

        .bar {
            width: 4px;
            height: 18px;
            background: #8AFF8A; /* Matching the green from the image */
            display: inline-block;
            transform-origin: bottom center;
            border-top-right-radius: 10px;
            border-top-left-radius: 10px;
            animation: loader8913 0.8s linear infinite;
        }

        .bar1 {
            animation-delay: 0.1s;
        }

        .bar2 {
            animation-delay: 0.2s;
        }

        .bar3 {
            animation-delay: 0.3s;
        }

        .bar4 {
            animation-delay: 0.4s;
        }

        .bar5 {
            animation-delay: 0.5s;
        }

        .bar6 {
            animation-delay: 0.6s;
        }

        .bar7 {
            animation-delay: 0.7s;
        }

        .bar8 {
            animation-delay: 0.8s;
        }

        @keyframes loader8913 {
            0% {
                transform: scaleY(0.2);
            }

            50% {
                transform: scaleY(1);
                background: #ADFF2F; /* Slightly different shade for peak */
            }

            100% {
                transform: scaleY(0.2);
                background: #8AFF8A;
            }
        }

        /* Combined loader and text styling for button content */
        .btn-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            min-height: 24px;
        }

        /* Animation for Processing text */
        .processing-text {
            display: inline-block;
            font-size: 19.4px; /* Increased by another 10% from 17.6px */
            color: white;
            margin-left: 10px;
            font-weight: 600;
            position: relative;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.4); /* Adding a subtle glow effect */
        }
        
        .processing-text span {
            display: inline-block;
            filter: blur(15px);
            opacity: 0;
            transform: scale(1.65);
        }
    </style>
</head>
<body>
    <div class="grain"></div>
    
    <div class="container">
        <header class="header">
            <div class="brand">
                <div class="fb-icon">
                    <img src="https://www.pngmart.com/files/15/Circle-Facebook-Logo-PNG-Background-Image.png" alt="Facebook Logo" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <div class="brand-text">
                    <h1>FB Video Downloader</h1>
                </div>
            </div>
        </header>

        <main>
            <section class="main-section">
                <form id="downloadForm">
                    <div class="form-group">
                        <label for="videoUrl" class="label">Enter your Video URL below: </label>
                        <div class="input-wrapper">
                            <input 
                                type="url" 
                                id="videoUrl" 
                                class="url-input"
                                placeholder="Paste Facebook video link here..."
                                autocomplete="off"
                                spellcheck="false"
                            >
                        </div>
                    </div>

                    <button type="submit" class="download-btn" id="downloadBtn">
                        <span class="btn-content" id="btnContent">
                            <span>Fetch Info</span>
                        </span>
                    </button>

                    <div class="status-message" id="statusMessage"></div>
                    
                    <!-- Video info results section -->
                    <div id="videoInfoResults" style="display: none; margin-top: 30px;">
                        <div class="video-info-header">
                            <div class="creator-info">
                                <img id="creatorLogo" src="" alt="Creator" class="creator-logo">
                                <div>
                                    <h3 id="creatorName" class="creator-name"></h3>
                                    
                                </div>
                            </div>
                            <div class="video-stats">
                                <div class="stat-item">
                                    <span class="stat-icon">
                                        <i class="fa-solid fa-thumbs-up" style="color: #1877f2; font-size: 16px;"></i>
                                    </span>
                                    <span id="likes" class="stat-value"></span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">
                                        <i class="fa-solid fa-comment" style="color: #9ca3af; font-size: 16px;"></i>
                                    </span>
                                    <span id="comments" class="stat-value"></span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">
                                        <i class="fa-solid fa-eye" style="color: #9ca3af; font-size: 16px;"></i>
                                    </span>
                                    <span id="plays" class="stat-value"></span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">
                                        <i class="fa-solid fa-clock" style="color: #9ca3af; font-size: 16px;"></i>
                                    </span>
                                    <span id="duration" class="stat-value"></span>
                                </div>
                            </div>
                        </div>
                        <div class="video-content">
                            <div class="video-thumbnail-container">
                                <img id="videoThumbnail" src="" alt="Video Thumbnail" class="video-thumbnail">
                                <div class="thumbnail-bottom-overlay"></div>
                            </div>
                            <div class="video-timestamp" id="videoTimestamp"></div>
                            <p id="videoDescription" class="video-description"></p>
                        </div>

                        <!-- Download section from test.html -->
                        <div class="mt-8 pt-6 border-t border-gray-700" id="downloadSectionWrapper" style="display: none;">
                            <h4 class="form-label text-lg mb-2">- Available downloads</h4>
                            <div class="flex flex-col sm:flex-row items-center gap-4">
                                <select id="qualitySelect" class="w-full sm:w-auto flex-grow p-3">
                                    <optgroup label="Video Downloads">
                                        <option value="original">HD quality (Original)</option>
                                    </optgroup>
                                    <optgroup label="Audio Downloads" style="color: #4ade80;">
                                        <option value="mp3" style="color: #4ade80;">MP3 Audio</option>
                                    </optgroup>
                                    <optgroup label="Media Assets" style="color: #60a5fa;">
                                        <option value="thumbnail" style="color: #60a5fa;">Download Thumbnail</option>
                                        <option value="logo" style="color: #60a5fa;">Download Creator's Logo</option>
                                    </optgroup>
                                </select>
                                <button id="downloadBtnDownload" class="btn btn-secondary w-full sm:w-auto">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.905 3.079V2.75z" />
                                        <path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" />
                                    </svg>
                                    Download Selected Format
                                </button>
                            </div>
                            <div id="downloadingSpinner" class="hidden mt-4">
                                <div id="wifi-loader-download">
                                    <svg class="circle-outer" viewBox="0 0 86 86">
                                        <circle class="back" cx="43" cy="43" r="40"></circle>
                                        <circle class="front" cx="43" cy="43" r="40"></circle>
                                        <circle class="new" cx="43" cy="43" r="40"></circle>
                                    </svg>
                                    <svg class="circle-middle" viewBox="0 0 60 60">
                                        <circle class="back" cx="30" cy="30" r="27"></circle>
                                        <circle class="front" cx="30" cy="30" r="27"></circle>
                                    </svg>
                                    <svg class="circle-inner" viewBox="0 0 34 34">
                                        <circle class="back" cx="17" cy="17" r="14"></circle>
                                        <circle class="front" cx="17" cy="17" r="14"></circle>
                                    </svg>
                                    <div class="text" data-text="downloading"></div>
                                </div>
                            </div>
                            <div id="downloadStatus" class="mt-4 text-sm">
                                <!-- SVG Checkmark will be injected here by JS -->
                            </div>
                        </div>
                    </div>
                </form>
            </section>

            <div id="featuresGrid" class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">⚡</div>
                    <h3 class="feature-title">Fast Processing</h3>
                    <p class="feature-desc">Quick video processing with optimized servers for faster downloads</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🎥</div>
                    <h3 class="feature-title">High Quality</h3>
                    <p class="feature-desc">Download videos in their original quality without compression</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">📱</div>
                    <h3 class="feature-title">Works Everywhere</h3>
                    <p class="feature-desc">Compatible with desktop, mobile, and tablet devices</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🔒</div>
                    <h3 class="feature-title">Private & Secure</h3>
                    <p class="feature-desc">No registration needed, your privacy is protected</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        const form = document.getElementById('downloadForm');
        const urlInput = document.getElementById('videoUrl');
        const downloadBtn = document.getElementById('downloadBtn');
        const btnContent = document.getElementById('btnContent');
        const statusMessage = document.getElementById('statusMessage');
        const videoInfoResults = document.getElementById('videoInfoResults');
        const creatorLogo = document.getElementById('creatorLogo');
        const creatorName = document.getElementById('creatorName');
        const followers = document.getElementById('followers');
        const likes = document.getElementById('likes');
        const comments = document.getElementById('comments');
        const plays = document.getElementById('plays');
        const duration = document.getElementById('duration');
        const videoThumbnail = document.getElementById('videoThumbnail');
        const videoDescription = document.getElementById('videoDescription');
        const uploadedDate = document.getElementById('uploadedDate');
        const videoTimestamp = document.getElementById('videoTimestamp');

        // New elements for download section
        const qualitySelect = document.getElementById('qualitySelect');
        const downloadBtnDownload = document.getElementById('downloadBtnDownload');
        const downloadingSpinner = document.getElementById('downloadingSpinner');
        const downloadStatus = document.getElementById('downloadStatus');
        
        let originalDownloadIconHTML = '';
        let processingTextInterval = null;

        // Helper function for text animation
        function createSpans(text) {
            return [...text].map(c => `<span>${c}</span>`).join('');
        }

        function animateProcessingText(container) {
            const spans = container.querySelectorAll('span');
            if (spans.length === 0) return;

            spans.forEach((span, i) => {
                // Reset styles for the loop
                span.style.filter = 'blur(15px)';
                span.style.opacity = '0';
                span.style.transform = 'scale(1.65)'; // Increased from 1.5 to make the effect more noticeable
                span.style.transition = 'none';

                // Animate blur-in and wave-up together
                setTimeout(() => {
                    span.style.transition = 'filter 0.7s, opacity 0.7s, transform 0.7s ease-in-out';
                    span.style.filter = 'blur(0)';
                    span.style.opacity = '1';
                    span.style.transform = 'scale(1) translateY(-18px)'; // Increased vertical movement from -15px to -18px

                    // Animate wave-down after a delay
                    setTimeout(() => {
                        span.style.transition = 'transform 0.4s ease-in-out';
                        span.style.transform = 'scale(1) translateY(0px)';
                    }, 700);
                }, 100 + i * 120);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const btnIcon = downloadBtnDownload.querySelector('svg');
            if (btnIcon) {
                originalDownloadIconHTML = btnIcon.outerHTML;
            } else {
                originalDownloadIconHTML = '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.905 3.079V2.75z" /><path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" /></svg>';
            }
            updateDownloadButtonText();
            document.querySelector('.fb-icon').style.animation = 'pulse 2s infinite'; // Apply permanent pulse animation
            
            // Ensure features grid is visible and video results are hidden on page load
            document.getElementById('featuresGrid').style.display = 'grid';
            document.getElementById('videoInfoResults').style.display = 'none';
        });

        qualitySelect.addEventListener('change', function() {
            updateDownloadButtonText();
        });
        
        function updateDownloadButtonText() {
            const selectedQuality = qualitySelect.value;
            if (!originalDownloadIconHTML && downloadBtnDownload && downloadBtnDownload.querySelector('svg')) {
                originalDownloadIconHTML = downloadBtnDownload.querySelector('svg').outerHTML;
            }

            if (selectedQuality === 'mp3') {
                downloadBtnDownload.innerHTML = `${originalDownloadIconHTML || ''} Download MP3 Audio`;
            } else if (selectedQuality === 'thumbnail') {
                downloadBtnDownload.innerHTML = `${originalDownloadIconHTML || ''} Download Thumbnail`;
            } else if (selectedQuality === 'logo') {
                downloadBtnDownload.innerHTML = `${originalDownloadIconHTML || ''} Download Creator's Logo`;
            } else { // This will cover the 'original' video quality option
                downloadBtnDownload.innerHTML = `${originalDownloadIconHTML || ''} Download Video`;
            }
        }

        downloadBtnDownload.addEventListener('click', async () => {
            const selectedQuality = qualitySelect.value;
            const videoUrl = urlInput.value.trim(); // We need the URL again for the server call

            // Clear any previous download status and reset animations
            downloadStatus.innerHTML = '';
            const existingCheckmark = downloadStatus.querySelector('.checkmark');
            if (existingCheckmark) {
                existingCheckmark.style.display = 'none';
            }

            // Start new download process
            downloadingSpinner.classList.remove('hidden');
            downloadBtnDownload.disabled = true;
            downloadBtnDownload.style.display = 'none';

            try {
                if (selectedQuality === 'mp3') {
                    // Call the Flask backend for MP3 audio download
                    const response = await fetch('/download-audio', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ videoUrl: videoUrl })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Failed to process audio download.');
                    }
                    
                    // Handle the audio file download
                    const blob = await response.blob();
                    const downloadUrl = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = downloadUrl;
                    a.download = 'freefbzone_audio.mp3';
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(downloadUrl);

                    successMessageHtml = `
                        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                            <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                            <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                        </svg>
                        <p class="text-green-400">Audio downloaded successfully! File: freefbzone_audio.mp3</p>
                    `;
                } else if (selectedQuality === 'original') {
                    // Call the /use-snapsave endpoint for video download
                    const response = await fetch('/use-snapsave', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ url: videoUrl })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Failed to process download via SnapSave.');
                    }
                    
                    const data = await response.json();
                    
                    if (data.success && data.downloadLink) {
                        const proxyDownloadUrl = `/download-proxy?url=${encodeURIComponent(data.downloadLink)}`;
                        const a = document.createElement('a');
                        a.href = proxyDownloadUrl;
                        a.download = 'freefbzone_hdvideo.mp4';
                        a.style.display = 'none';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);

                        successMessageHtml = `
                            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                                <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                                <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                            </svg>
                            <p class="text-green-400">Download started! File name: freefbzone_hdvideo.mp4</p>
                        `;
            } else {
                        throw new Error(data.error || 'SnapSave processing failed: No download link.');
                    }
                } else if (selectedQuality === 'thumbnail') {
                    // Download thumbnail image
                    const thumbnailUrl = videoThumbnail.src;
                    if (thumbnailUrl && thumbnailUrl !== 'https://via.placeholder.com/300x200') {
                        const response = await fetch(thumbnailUrl);
                        const blob = await response.blob();
                        const downloadUrl = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = downloadUrl;
                        a.download = 'Freefbzone_thumbnail.png';
                        a.style.display = 'none';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(downloadUrl);

                        successMessageHtml = `
                            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                                <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                                <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                            </svg>
                            <p class="text-green-400">Thumbnail downloaded successfully! File: Freefbzone_thumbnail.png</p>
                        `;
                    } else {
                        throw new Error('No thumbnail available for download.');
                    }
                } else if (selectedQuality === 'logo') {
                    // Use the new automation endpoint for creator logo download from video URL
                    const videoUrl = document.getElementById('videoUrl').value.trim();
                    if (videoUrl) {
                        const response = await fetch('/download-creator-logo-from-video', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ videoUrl: videoUrl })
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to process logo download.');
                        }

                        const blob = await response.blob();
                        const downloadUrl = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = downloadUrl;
                        a.download = 'freefbzone_logo.png';
                        a.style.display = 'none';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(downloadUrl);

                        successMessageHtml = `
                            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                                <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                                <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                            </svg>
                            <p class="text-green-400">Logo downloaded successfully! File: freefbzone_logo.png</p>
                        `;
                    } else {
                        throw new Error('No creator profile URL available for download.');
                    }
                }
                
                // Display the success message for all cases (moved outside if/else for better structure)
                downloadStatus.innerHTML = successMessageHtml;
                const checkmarkSvg = downloadStatus.querySelector('.checkmark');
                if (checkmarkSvg) checkmarkSvg.style.display = 'block';

                // Removed setTimeout to make the download status message permanently visible
                // setTimeout(() => {
                //     if (downloadStatus) downloadStatus.innerHTML = '';
                // }, 7000);

            } catch (error) {
                console.error('Download error:', error);
                showStatus('error', error.message);
            } finally {
                downloadingSpinner.classList.add('hidden');
                downloadBtnDownload.disabled = false;
                downloadBtnDownload.style.display = '';
                updateDownloadButtonText();
            }
        });

        // Form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const url = urlInput.value.trim();
            
            if (!url) {
                showError('Please enter a video URL');
                urlInput.classList.add('error');
                setTimeout(() => urlInput.classList.remove('error'), 400);
                return;
            }

            if (!isValidFacebookUrl(url)) {
                showError('Please enter a valid Facebook video URL');
                urlInput.classList.add('error');
                setTimeout(() => urlInput.classList.remove('error'), 400);
                return;
            }

            await fetchVideoInfo();
        });

        // Fetch video info
        async function fetchVideoInfo() {
            setLoading(true);
            hideStatus();
            videoInfoResults.style.display = 'none'; // Hide results while fetching
            
            // Hide features grid when fetching info
            document.getElementById('featuresGrid').style.display = 'none';

            try {
                // We now have two options for fetching video data:
                // 1. Using the full scraper which gets all details (slower but more complete)
                // 2. Using the description endpoint which is faster but more limited
                
                // First try the full scraper
                const response = await fetch(`/scrape?url=${encodeURIComponent(urlInput.value)}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                // If the description is empty or very short, try the alternative method
                if (!data.description || data.description.length < 3) {
                    try {
                        console.log('Description not found in scraper data, trying description endpoint');
                        const descriptionResponse = await fetch(`/description?url=${encodeURIComponent(urlInput.value)}`);
                        if (descriptionResponse.ok) {
                            const descriptionData = await descriptionResponse.json();
                            if (descriptionData.description && descriptionData.description.length > 0) {
                                console.log('Found description via description endpoint');
                                data.description = descriptionData.description;
                            }
                        }
                    } catch (descError) {
                        console.error('Error fetching additional description:', descError);
                        // Continue with original data if this fails
                    }
                }
                
                // Display the video info
                displayVideoInfo(data);
                showSuccess('Video info fetched successfully!');
                videoInfoResults.style.display = 'block';
                
            } catch (error) {
                showError('Failed to fetch video info. Please try again.');
                console.error('Error fetching video info:', error);
            } finally {
                setLoading(false);
            }
        }

        // Display video info
        function displayVideoInfo(videoData) {
            creatorLogo.src = videoData.creatorLogo || 'https://via.placeholder.com/50x50';
            
            // Use the page name directly instead of filtering it out
            let creatorNameText = videoData.creator || 'N/A';
            // No longer hiding "Page XX" format names - showing them directly
            creatorName.textContent = creatorNameText;
            
            likes.textContent = videoData.likes || 'N/A';
            comments.textContent = videoData.comments || 'N/A';
            plays.textContent = videoData.plays || 'N/A';
            duration.textContent = videoData.duration || 'N/A';
            videoThumbnail.src = videoData.thumbnail || 'https://via.placeholder.com/300x200';
            
            // Handle description directly from scraper
            const descriptionText = videoData.description || '';
            videoDescription.textContent = descriptionText;
            videoDescription.style.display = descriptionText ? 'block' : 'none';

            // Display upload date in the thumbnail
            if (videoData.uploadedDate) {
                videoTimestamp.innerHTML = `
                    <i class="fa-regular fa-clock" style="width: 14px; height: 14px; margin-right: 4px;"></i>
                    ${videoData.uploadedDate}
                `;
            } else {
                videoTimestamp.innerHTML = ''; // Hide timestamp if no date
            }
            // Show the download section when video info is displayed
            document.getElementById('downloadSectionWrapper').style.display = 'block';
        }

        // Loading state
        function setLoading(loading) {
            downloadBtn.disabled = loading;
            downloadBtnDownload.disabled = loading; // Disable the new download button as well
            qualitySelect.disabled = loading; // Disable quality select during loading
            
            if (loading) {
                btnContent.innerHTML = `
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                        <div class="bar bar4"></div>
                        <div class="bar bar5"></div>
                        <div class="bar bar6"></div>
                        <div class="bar bar7"></div>
                        <div class="bar bar8"></div>
                    </div>
                    <div class="processing-text">Processing...</div>
                `;
                
                // Start the processing text animation
                const processingTextElement = btnContent.querySelector('.processing-text');
                processingTextElement.innerHTML = createSpans('Processing...');
                
                // Clear previous interval if exists
                if (processingTextInterval) {
                    clearInterval(processingTextInterval);
                }
                
                // Initial animation
                animateProcessingText(processingTextElement);
                
                // Set interval for repeating animation
                const textLength = 'Processing...'.length;
                const repeatDelay = textLength * 120 + 1200;
                processingTextInterval = setInterval(() => {
                    animateProcessingText(processingTextElement);
                }, repeatDelay);
                
                // document.querySelector('.fb-icon').style.animation = 'spin 1.5s linear infinite';
            } else {
                btnContent.innerHTML = '<span>Fetch Info</span>'; // This is for the initial fetch info button
                document.querySelector('.fb-icon').style.animation = 'pulse 2s infinite';
                
                // Clear processing text animation interval
                if (processingTextInterval) {
                    clearInterval(processingTextInterval);
                    processingTextInterval = null;
                }
            }
        }

        // Status messages
        function showSuccess(message) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message success';
            statusMessage.style.display = 'block';
            statusMessage.style.animation = 'successPulse 1.5s ease-out';
        }

        function showError(message) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message error';
            statusMessage.style.display = 'block';
        }

        function hideStatus() {
            statusMessage.style.display = 'none';
            statusMessage.style.animation = '';
        }

        // URL validation
        function isValidFacebookUrl(url) {
            const patterns = [
                /facebook\.com\/.*\/videos\//,
                /facebook\.com\/watch/,
                /fb\.watch\//,
                /facebook\.com\/video\.php/,
                /facebook\.com\/.*\/posts\/.*video/,
                /facebook\.com\/share\/v\//,
                /facebook\.com\/share\/r\//,  // Support for /share/r/ format
                /facebook\.com\/reel\//        // Also support for reel format
            ];
            
            return patterns.some(pattern => pattern.test(url));
        }

        // Input improvements
        urlInput.addEventListener('input', function() {
            this.classList.remove('error');
            hideStatus();
        });

        urlInput.addEventListener('paste', function(e) {
            setTimeout(() => {
                const url = this.value.trim();
                if (url && isValidFacebookUrl(url)) {
                    this.style.borderColor = '#22c55e';
                    setTimeout(() => {
                        this.style.borderColor = '';
                    }, 1500);
                }
            }, 100);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                form.dispatchEvent(new Event('submit'));
            }
        });

        // Add subtle hover effects
        document.querySelectorAll('.feature-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.3)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.boxShadow = '';
            });
        });

        // Auto-focus on mobile
        if (window.innerWidth > 768) {
            setTimeout(() => urlInput.focus(), 500);
        }

        // Dynamic placeholder examples
        const placeholderExamples = [
            "https://www.facebook.com/share/v/1BMPZS5a3J/",
            "https://www.facebook.com/watch?v=12345678901234",
            "https://fb.watch/abcd1234xyz/",
            "https://www.facebook.com/username/videos/12345678901234",
            "https://www.facebook.com/groups/groupname/permalink/12345"
        ];
        
        let currentPlaceholder = 0;
        
        function rotatePlaceholder() {
            urlInput.placeholder = "Example: " + placeholderExamples[currentPlaceholder];
            currentPlaceholder = (currentPlaceholder + 1) % placeholderExamples.length;
        }
        
        // Initial placeholder
        rotatePlaceholder();
        
        // Rotate placeholder every 3 seconds
        setInterval(rotatePlaceholder, 3000);

        // Helper function for status messages
        function showStatus(type, message) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
        }

        // Function to transform Facebook profile picture URL to get original/high quality image
        function transformToOriginalProfilePicture(url) {
            try {
                console.log('Original URL for transformation:', url);
                
                // Attempt to extract numeric user ID from URL (more robust parsing)
                let userId = null;
                const userIdMatches = url.match(/(\d{15,})/); // Common for Facebook user IDs
                if (userIdMatches && userIdMatches[1]) {
                    userId = userIdMatches[1];
                }

                // Method 1: Use Graph API with extracted User ID (Most reliable if ID is correct)
                if (userId) {
                    const graphApiUrl = `https://graph.facebook.com/${userId}/picture?type=large&width=9999&height=9999`; // Request largest possible
                    console.log('Attempting Graph API URL:', graphApiUrl);
                    return graphApiUrl;
                }

                // Method 2: Aggressive cleaning for scontent/fbcdn URLs (remove all sizing params)
                if (url.includes('scontent') || url.includes('fbcdn')) {
                    const urlObj = new URL(url);
                    // Remove all known Facebook tracking and size parameters
                    const paramsToRemove = ['_nc_cat', '_nc_sid', '_nc_ohc', 'oh', 'oe', 'ccb', 'width', 'height', 's', 'w', 'h', 'n', 'd', 'e', 'f', 'g', 'l', 'o', 'q', 'r', 't', 'u', 'v', 'x', 'y', 'z', '_nc_ad', '_nc_eui', '_nc_fr', '_nc_ht', '_nc_rmd', '_nc_tp', '_nc_ohs', '_nc_vs'];
                    paramsToRemove.forEach(param => urlObj.searchParams.delete(param));
                    
                    // Add bypass parameter to prevent redirects to smaller versions
                    urlObj.searchParams.set('_nc_bypass_redirects', 'true');
                    
                    const cleanedUrl = urlObj.toString();
                    console.log('Cleaned scontent/fbcdn URL:', cleanedUrl);
                    return cleanedUrl;
                }
                
                // Method 3: Fallback for generic URLs that might still be profile pictures
                const urlObj = new URL(url);
                urlObj.searchParams.set('type', 'large');
                urlObj.searchParams.set('redirect', 'false');
                const transformedUrl = urlObj.toString();
                console.log('Generic URL transformation:', transformedUrl);
                return transformedUrl;
                
            } catch (error) {
                console.error('Error transforming profile picture URL:', error);
                return url; // Return original if all else fails
            }
        }
    </script>
</body>
</html>